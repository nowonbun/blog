<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="naver-site-verification" content="32aa8ce7d767e05669cb5b31f2579de56cc15359" />
    <meta name="keywords" content="명월 일기, 프로그램 개발, 프로젝트 구축, 개발 노하우" />
    <meta name="description" content="앞에서 기본 디자인과 로그인에 대해서 작성했다. 이번에는 공통부분과 댓글 추가하는 부분을 만들어 볼까 한다.검색 부분은 조금 복잡하므로 다음.." />
    <meta name="Author" content="nowonbun@gmail.com" />
    <meta name="distribution" content="nowonbun@gmail.com" />
    <meta name="copyright" content="nowonbun@gmail.com" />
    <meta name="title" content="명월의 개발 일기 : [개발일기] : [블로그 구축 17일 차] 블로그 댓글 시스템 달기 -8 (client 작성)" />
    <meta name="robots" content="ALL">
    <meta property="og:title" content="명월의 개발 일기" />
    <meta property="og:description" content="앞에서 기본 디자인과 로그인에 대해서 작성했다. 이번에는 공통부분과 댓글 추가하는 부분을 만들어 볼까 한다.검색 부분은 조금 복잡하므로 다음.." />
    <meta property="og:url" content="http://www.nowonbun.com/Dialy/c4097e40237147c696ba6c0af47a8718.html" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="명월 일기, 프로그램 개발, 프로젝트 구축, 개발 노하우" />

    <meta property="og:image" content="http://www.nowonbun.com/img/ogimage.jpg" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="200" />
    <meta property="og:image:height" content="200" />
    <meta property="og:image:alt" content="명월 일기 타이포 그래피" />
    <meta name="google-signin-client_id" content="220458850151-75q8c5ids3m5krr49qj4tif6t84liubj.apps.googleusercontent.com">

    <title>명월의 개발 일기 : [개발일기] : [블로그 구축 17일 차] 블로그 댓글 시스템 달기 -8 (client 작성)</title>
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="/css/compiled-4.5.9.min.css" rel="stylesheet">
    <link href="/css/style.min.css" rel="stylesheet">
    <link href="/css/common.css" rel="stylesheet">
    <link href="/css/post.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/rainbow.min.css" rel="stylesheet">
    <link href="/css/highlight.init.css" rel="stylesheet">
    <link href="/css/comment.css" rel="stylesheet">

    <link rel="icon" type="favicon.ico" href="/img/favicon.ico">
    <link rel="canonical" href="http://www.nowonbun.com" />
    <link rel="alternate" type="application/rss+xml" title="명월의 개발 일기" href="http://www.nowonbun.com/rss" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-58360998-4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-58360998-4');
    </script>
    <script type="text/javascript" src="//wcs.naver.net/wcslog.js"></script>
    <script type="text/javascript">
        if (!wcs_add) var wcs_add = {};
        wcs_add["wa"] = "c2a9ed02f53908";
        wcs_do();
    </script>
</head>
<body lang="ko">
    <div id="bodyMain" class="container wow fadeIn animated" style="visibility: visible; animation-name: fadeIn;">
        <header class="mt-5">
            <section class="card my-blog-header">
                <div class="background"></div>
                <div class="card-body text-center py-3 px-3 my-3">
                    <h1 class="mb-4" style="margin:0px!important;">
                        <strong>명월의 개발 일기</strong>
                    </h1>
                </div>
                <nav class="navbar navbar-expand-lg navbar-light white menu-nav-tool-blog">
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" id="menuToggler">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mr-auto">
                            <li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/'>홈</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog  active ' href='/DialyList.html'>개발일기</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/ExperienceList.html'>개발경험</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/JapanLifeList.html'>일본생활</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/KoreanLifeList.html'>한국생활</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/CodingNoteList.html'>코딩노트</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/FavoritesList.html'>즐겨찾기</a></li>

                        </ul>
                    </div>
                </nav>
            </section>
        </header>
        <main class="mt-5">
            <div class="row mb-3">
                <div class="col-12 d-flex align-items-stretch">
                    <div class="card my-blog-post">
                        <div class="card-body">
                            <h2 class="card-title">
                                [블로그 구축 17일 차] 블로그 댓글 시스템 달기 -8 (client 작성)
                            </h2>
                            <div class="row justify-content-end mb-3 date-items">
                                <div class="col-12" style="line-height:10px;text-align:right;">
                                    <div class="date-type-1">
                                        <span class="my-list-date font-7">작성일시 : 2018년 12월 05일 22시 28분</span><br />
                                        <span class="my-list-date font-7">최종수정일시 : 2018년 12월 15일 02시 45분</span>
                                    </div>
                                    <div class="date-type-2">
                                        <span class="my-list-date font-7">작성: 2018-12-05 22:28</span><br />
                                        <span class="my-list-date font-7">최종수정: 2018-12-15 02:45</span>
                                    </div>
                                    <div style="display:inline-block">
                                        <img src="/img/copyrightmark.png" style="height: 25px;margin-top: -13px;margin-left: 11px;">
                                    </div>
                                </div>
                            </div>
                            <div class="card-text pt-3 pb-3">
                                <!--<div class='view overlay rounded z-depth-1 post-image-area'>
                                    <img class='article-image img-fluid' src='#####IMAGE#####' />
                                    <div class='mask rgba-white-slight'></div>
                                </div>
                                <p class="image-comment">#####IMAGECOMMNET#####</p>-->
                                <article>
                                    <p>&nbsp;앞에서 기본 디자인과 로그인에 대해서 작성했다. 이번에는 공통부분과 댓글 추가하는 부분을 만들어 볼까 한다.</p><p>검색 부분은 조금 복잡하므로 다음에 한꺼번에 작성할 생각이다.</p><p><br></p><p>&nbsp;웹 클라이언트에서 사용하는 스크립트는 javascript이다. 그러나 javascript의 바닐라 버전(순수 버전)으로 사용하면 꽤 복잡하다. 사실 한 10년 전만 해도 바닐라 버전만 사용했었는데 최근에는 jquery만 사용하다 보니 다시 바닐라 버전으로만은 못할 것 같다. 이유는 코드가 어마어마하게 길어질 것 같아서이다. 그래서 요즘은 바날라 버전으로 만들기 힘들어서 angularJs, jquery 등 많은 라이브러리가 있다. 그중 나는 jquery만 사용하고 있다. 예전에 angularJs로 만들어 본 적이 있는데 남들은 이게 편하다고 하는데 나는 당최 뭐가 편한지 모르겠다. 그냥 코드만 더 길어지고 복잡만 해지는 것 같던데.. 물론 onepage 시스템을 만들면 편할 거 같은데 굳이 onepage로 시스템을 통으로 만들 필요성을 아직은 느끼질 못하겠다.</p><p><br></p><p>&nbsp;jquery는 javascript의 라이브러리이다. 이 뜻은 jquery라 javascript의 기반으로 함수를 좀 더 편하게 사용하기 위해 재정의를 했다고 보면 된다. 그 뜻은 jquery를 사용하더라도 javascript를 모르면 사용할 수 없다는 뜻이다.</p><pre><code class="javascript" data-type="jquery common 소스">function commentAjax(url,data,reload,cb){
  $.ajax({
    url: "//*댓글 서버 URL*//"+url,
    type: "POST",
    dataType: "json",
    data: data,
    success: function (data, textStatus, jqXHR) {
      cb.call(this, data);
      if(reload){
        // 검색
      }
    },
    error: function (jqXHR, textStatus, errorThrown) {
      console.log(jqXHR);
      $("#commentSystem").css("text-align","center");
      $("#commentSystem").html("&lt;img src='/img/image_fix.png' style='height: 40px'&gt;");
      toastr.success("시스템 에러입니다.");
    },
    complete: function (jqXHR, textStatus) { }
  });
}
function checkLogin(){
  if($.trim(auth.id) === ""){
    toastr.error("로그인 해주시기 바랍니다.");
    return false;
  }
  if($.trim(auth.email) === ""){
    toastr.error("로그인 해주시기 바랍니다.");
    return false;
  }
  return true;
}</code></pre><p>&nbsp;원래 나는 javascript 코드를 만들 때, model-controller로 구성하고 외부 참조변수, 내부 변수 구분해서 작성한다. 그러나 지금 만드는 기능은 워낙 사이즈가 작고 간단한 프로그램이라 오히려 model-controller로 만들어서 하면 더 복잡해질 거 같다. 그래서 그냥 public function으로 만들었다.</p><p><br></p><p>&nbsp;먼저 commentAjax는 추가, 검색, 삭제, 수정이 모두 ajax로 서버로 접속하기 때문에 공통으로 묶었습니다. 이번 서버측 php와 비슷한 설정이다. 서버 모두 post 형식으로 받기 때문에 타입은 POST로 고정하고, 모두 json형식으로 데이터를 받기 때문에 데이터 타입도 json으로 고정했다. 성공했을 때는 cb의 콜백함수를 호출하고 댓글을 다시 reload하는 형식으로 만들었다.그리고 에러가 나면 에러 메시지가 나오고 댓글 element를 hide시킨다.</p><p><br></p><p>&nbsp;checkLogin은 우리가 서버로 접속하기 전에 무조건 login상태를 확인하기 위한 공통함수이다. 서버측에서 추가, 검색, 삭제, 수정할때 id와 email값을 받아야 하기 때문에 필수라고 할수 있다.</p><pre><code class="javascript" data-type="jquery 댓글 추가 소스">$(function(){
  $("#createComment").on("click", function(){
    if(!checkLogin()) return;
    var comment = $("#commentText").val().replace("\r\n"," ").replace("\r"," ").replace("\n"," ");
    if($.trim(comment) === ""){
      toastr.error("댓글 내용을 입력해 주시기 바랍니다.");
      return;
    }
    var data = "url="+location.origin + location.pathname + "&amp;" +
               "id="+auth.id + "&amp;" +
               "email="+auth.email + "&amp;" +
               "comment="+comment;
    commentAjax("/add.php", data, true, function(){
      toastr.success("등록되었습니다.");
      $("#commentText").val("");
      $(".comment-textarea-label").removeClass("active");
    });
  });
});</code></pre><p>&nbsp;여기는 댓글을 추가하는 부분이다. 기본적으로 나는 javascript를 html 구성 중 가장 밑에 배치하므로 document.ready를 기다릴 필요는 없다. 그러나 코드의 가독성과 앞으로 어떻게 수정될지 모르기 때문에 이벤트를 document.ready안에 넣는다. document.ready는 jquery에서 $(function(){ }); 의 형태로 만들어진다.</p><p><br></p><p>&nbsp;댓글 추가할 때는 먼저 공통함수의 checkLogin로 로그인 체크합니다. 그리고 comment영역에서 엔터를 모두 띄어쓰기로 치환했습니다. 300자 제한을 했는데 모두 엔터를 쳐서 입력하면 댓글 구조가 이상해 지니깐 입니다. 이 부분을 서버 부분에서도 체크하는 게 좋을 것같다. 여기를 만들다 보니 갑자기 체크해야 겠다는 생각이 들었다. 서버측 php도 수정해놔야겠다.</p><p><br></p><p>&nbsp;그리고 파라미터는 서버 요구사항대로 url, id, email, comment를 받아서 전송한다. id, email은 구글 oauth2에서 받은 정보이다. 그리고 성공 콜백이 오면 등록 메시지 표시하고 코멘트 텍스트 박스를 초기화한다.</p><p><br></p><p>&nbsp;댓글 추가는 간단해서 어려운 코드가 없다. 다음 검색 부분이 가장 복잡하지 않을까 생각된다.</p><p>&nbsp;&nbsp;</p><p>&nbsp;댓글 기능에 대한 소스는 아래 github에 있습니다.&nbsp;</p><p>&nbsp;github -&nbsp; <a href="https://github.com/nowonbun/BlogComment" target="_blank">https://github.com/nowonbun/BlogComment</a></p>
                                </article>
                            </div>
                            <div class="row justify-content-end mb-3 date-items">
                                <div class="col-12 font-7 text-align-right gray-font">
                                    <p class="mb-0"><span class="text-align-left" style="display:inline-block;">블로그의 글은 모두 개인 경험과 지식으로 나온 글이기에 정확하지 않을 수 있습니다. 표준 또는 사실과 다른 글이 있으면 댓글 또는 메일 보내주세요.</span></p>
                                    <p class="mb-0">Mail: <a href="mailto:nowonbun@gmail.com">nowonbun@gmail.com</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class='row mt-3 mb-3'><div class='col-12 d-flex align-items-stretch'><div class='card my-style-custom'><div class='my-pre-post-nav'><div class='row'><div class='col-12 mb-1'><p class='my-pre-list-title' style='margin-bottom:0px;'><a class='prenext-link' href='/Dialy/commentDisign.html'> <span class='my-pre-next-icon'><i class='fa fa-chevron-up'></i>이전글</span>[블로그 구축 16일 차] 블로그 댓글 시스템 달기 -7(client 작성)</a><span class='my-list-date float-right date-type-1 font-7'>2018년 12월 04일 23시 13분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-12-04 23:13 작성</span></p></div> <div class='col-12 my-blog-line'></div> <div class='col-12 mt-1'><p class='my-pre-list-title' style='margin-bottom:0px;'><a class='prenext-link' href='/Dialy/90f51b80de17467fb55c535980313ff9.html'> <span class='my-pre-next-icon'><i class='fa fa-chevron-down'></i>다음글</span>[블로그 구축 18일 차] 블로그 댓글 시스템 달기 -9 (client 작성)</a><span class='my-list-date float-right date-type-1 font-7'>2018년 12월 06일 21시 53분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-12-06 21:53 작성</span></p></div></div></div></div></div></div>
            <fieldset class="box-shadow-0 px-3 py-3 blog-radius mb-3 my-style-custom">
                <legend class="box-shadow-0 blog-legend px-3 blog-radius mb-0">
                    <label>최신글</label>
                </legend>
                <ul class="pl-3">
                    <li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/9c7d5ba0b5954857a0755e59c1cf6645.html'>[개발일기] [Tistory Blog Editor -11] 카테고리 리스트<span class='my-list-date float-right date-type-1 font-7'>2019년 04월 24일 00시 13분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2019-04-24 00:13 작성</span></a></div></li><li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/d8d2939f4d13461181f35192f71746f2.html'>[개발일기] [Tistory Blog Editor -10] 메뉴 만들기<span class='my-list-date float-right date-type-1 font-7'>2019년 04월 23일 00시 04분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2019-04-23 00:04 작성</span></a></div></li><li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/3631cbafedab48e69da20b7155cd8f3f.html'>[개발일기] [Tistory Blog Editor -9] 관리 페이지 - 동기화(3)<span class='my-list-date float-right date-type-1 font-7'>2019년 04월 21일 23시 56분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2019-04-21 23:56 작성</span></a></div></li><li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/201904191221.html'>[개발일기] [Tistory Blog Editor -8] 관리 페이지 - 동기화(2)<span class='my-list-date float-right date-type-1 font-7'>2019년 04월 19일 00시 21분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2019-04-19 00:21 작성</span></a></div></li><li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/a4167b57525249dfac5518f344631b87.html'>[개발일기] [Tistory Blog Editor -7] 관리 페이지 - 동기화(1)<span class='my-list-date float-right date-type-1 font-7'>2019년 04월 17일 23시 29분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2019-04-17 23:29 작성</span></a></div></li><li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/2c3df1eae14548359f9f3372617a46d5.html'>[개발일기] [Tistory Blog Editor -6] 전체 디자인 설정<span class='my-list-date float-right date-type-1 font-7'>2019년 04월 17일 00시 29분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2019-04-17 00:29 작성</span></a></div></li>
                </ul>
            </fieldset>
            <fieldset class="box-shadow-0 px-3 py-3 blog-radius mb-3 my-style-custom">
                <legend class="box-shadow-0 blog-legend px-3 blog-radius">
                    <label>댓글 달기</label>
                </legend>
                <div id="commentSystem">
					<div id="googleSigninButton"></div>
                    <div id="commentInsertForm" class="comment-form-border"  style="display:none;">
						<div style="text-align:right;">
							<button type="button" class="btn btn-sm btn-outline-success waves-effect" id="createComment">작성하기</button>
						</div>
						<div class="md-form comment-form">
						  <textarea id="commentText" class="form-control md-textarea comment-textarea" maxlength="300" length="300" rows="3"></textarea>
						  <label for="commentText" class="comment-textarea-label">댓글 작성하기</label>
						</div>
					</div>
					<div id="commentList" class="comment-list"></div>
                </div>
            </fieldset>
        </main>
        <footer class="page-footer text-center font-small mdb-color mt-4 wow fadeIn my-blog-footer">
            <div class="footer-copyright py-1">
                2018 Copyright: <a href="#" target="_blank">www.nowonbun.com </a>
            </div>
        </footer>
        <div id="ImgModal" class="modal">
            <span class="close">&times;</span>
            <img class="modal-content">
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="/js/compiled-4.5.9.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script src="/js/highlightjs-line-numbers.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>hljs.initLineNumbersOnLoad();</script>
    <script type="text/javascript" src="/js/post.js" charset="utf-8"></script>
    <script type="text/javascript" src="https://apis.google.com/js/platform.js?onload=onLoad" async defer></script>
    <script type="text/javascript" src="/js/comment.min.js"></script>
</body>
</html>