<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="naver-site-verification" content="32aa8ce7d767e05669cb5b31f2579de56cc15359" />
    <meta name="keywords" content="명월 일기, 프로그램 개발, 프로젝트 구축, 개발 노하우" />
    <meta name="description" content="데이터베이스 설계도 완료했으니 이제 본격적인 코딩이다. 본래는 프로그램 설계를 하고 코딩해야 정상적인 프로젝트 흐름이지만 복잡한 프로그램도 .." />
    <meta name="Author" content="nowonbun@gmail.com" />
    <meta name="distribution" content="nowonbun@gmail.com" />
    <meta name="copyright" content="nowonbun@gmail.com" />
    <meta name="title" content="명월의 개발 일기 : [개발일기] : [블로그 구축 13일 차] 블로그 댓글 기능 달기 -4 (server 작성)" />
    <meta name="robots" content="ALL">
    <meta property="og:title" content="명월의 개발 일기" />
    <meta property="og:description" content="데이터베이스 설계도 완료했으니 이제 본격적인 코딩이다. 본래는 프로그램 설계를 하고 코딩해야 정상적인 프로젝트 흐름이지만 복잡한 프로그램도 .." />
    <meta property="og:url" content="http://www.nowonbun.com/Dialy/32d7d7135654429faf3cbdfe618bae00.html" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="명월 일기, 프로그램 개발, 프로젝트 구축, 개발 노하우" />

    <meta property="og:image" content="http://www.nowonbun.com/img/ogimage.jpg" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="200" />
    <meta property="og:image:height" content="200" />
    <meta property="og:image:alt" content="명월 일기 타이포 그래피" />
    <meta name="google-signin-client_id" content="220458850151-75q8c5ids3m5krr49qj4tif6t84liubj.apps.googleusercontent.com">

    <title>명월의 개발 일기 : [개발일기] : [블로그 구축 13일 차] 블로그 댓글 기능 달기 -4 (server 작성)</title>
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="/css/compiled-4.5.9.min.css" rel="stylesheet">
    <link href="/css/style.min.css" rel="stylesheet">
    <link href="/css/common.css" rel="stylesheet">
    <link href="/css/post.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/rainbow.min.css" rel="stylesheet">
    <link href="/css/highlight.init.css" rel="stylesheet">
    <link href="/css/comment.css" rel="stylesheet">

    <link rel="icon" type="favicon.ico" href="/img/favicon.ico">
    <link rel="canonical" href="http://www.nowonbun.com" />
    <link rel="alternate" type="application/rss+xml" title="명월의 개발 일기" href="http://www.nowonbun.com/rss" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-58360998-4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-58360998-4');
    </script>
    <script type="text/javascript" src="//wcs.naver.net/wcslog.js"></script>
    <script type="text/javascript">
        if (!wcs_add) var wcs_add = {};
        wcs_add["wa"] = "c2a9ed02f53908";
        wcs_do();
    </script>
</head>
<body lang="ko">
    <div id="bodyMain" class="container wow fadeIn animated" style="visibility: visible; animation-name: fadeIn;">
        <header class="mt-5">
            <section class="card my-blog-header">
                <div class="background"></div>
                <div class="card-body text-center py-3 px-3 my-3">
                    <h1 class="mb-4" style="margin:0px!important;">
                        <strong>명월의 개발 일기</strong>
                    </h1>
                </div>
                <nav class="navbar navbar-expand-lg navbar-light white menu-nav-tool-blog">
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" id="menuToggler">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mr-auto">
                            <li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/'>홈</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog  active ' href='/DialyList.html'>개발일기</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/ExperienceList.html'>개발경험</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/JapanLifeList.html'>일본생활</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/KoreanLifeList.html'>한국생활</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/CodingNoteList.html'>코딩노트</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/FavoritesList.html'>즐겨찾기</a></li>

                        </ul>
                    </div>
                </nav>
            </section>
        </header>
        <main class="mt-5">
            <div class="row mb-3">
                <div class="col-12 d-flex align-items-stretch">
                    <div class="card my-blog-post">
                        <div class="card-body">
                            <h2 class="card-title">
                                [블로그 구축 13일 차] 블로그 댓글 기능 달기 -4 (server 작성)
                            </h2>
                            <div class="row justify-content-end mb-3 date-items">
                                <div class="col-12" style="line-height:10px;text-align:right;">
                                    <div class="date-type-1">
                                        <span class="my-list-date font-7">작성일시 : 2018년 12월 01일 23시 02분</span><br />
                                        <span class="my-list-date font-7">최종수정일시 : 2018년 12월 15일 02시 24분</span>
                                    </div>
                                    <div class="date-type-2">
                                        <span class="my-list-date font-7">작성: 2018-12-01 23:02</span><br />
                                        <span class="my-list-date font-7">최종수정: 2018-12-15 02:24</span>
                                    </div>
                                    <div style="display:inline-block">
                                        <img src="/img/copyrightmark.png" style="height: 25px;margin-top: -13px;margin-left: 11px;">
                                    </div>
                                </div>
                            </div>
                            <div class="card-text pt-3 pb-3">
                                <!--<div class='view overlay rounded z-depth-1 post-image-area'>
                                    <img class='article-image img-fluid' src='#####IMAGE#####' />
                                    <div class='mask rgba-white-slight'></div>
                                </div>
                                <p class="image-comment">#####IMAGECOMMNET#####</p>-->
                                <article>
                                    <p>&nbsp;데이터베이스 설계도 완료했으니 이제 본격적인 코딩이다. 본래는 프로그램 설계를 하고 코딩해야 정상적인 프로젝트 흐름이지만 복잡한 프로그램도 아니고 간단하니 바로 코딩 시작합니다.</p><p>&nbsp;서버 스크립트 사용 언어는 예전에 무료 호스팅 우비에서 사용하기로 했으니 php로 작성했다.</p><p><br></p><p>&nbsp;개인적으로 좋아하는 언어는 java와 C#같은 OOP(Object-Oriented Programming: 객체지향 프로그래밍)가 좋은데 무료 호스팅에서는 그 언어들을 지원하지 않는다. 왜 그럴까? java도 무료 언어인데. 이런 점이 참 아쉽다.</p><p>&nbsp;그렇다고 php가 성능이 떨어지는 언어는 아니다. 가볍고 빠르고 꽤 직관적인 언어라 구현이 매우 빠르다. 메모리 직접 참조가 없는데도 메모리 릭도 거의 없다.. 꽤 편리하고 좋은 언어다. 단점은 java처럼 메모리를 직접 관리하는 영역이 없어서 디자인 패턴 적용이 쉽지가 않다. 그리고 스레드를 직접 컨트롤할 수 있는 것도 아니다. 또 댓글 기능처럼 소형 프로젝트는 괜찮으나 대형 프로젝트로 가면 소스가 엄청나게 많으므로 관리도 만만치 않다.</p><p>그러나 댓글 기능은 복잡한 프로그램을 하는 게 아니고 간단하게 글쓰기, 수정하기, 삭제하기 그리고 검색하기를 ajax로 값을 가져올 수 있으면 되기 때문에 php로도 충분하다.</p><p><br></p><p>&nbsp;구성은 다음과 같이 생각하고 있다.</p><p>common.php - 공통 부분 (comment entity, abstract controller, db connection)</p><p>add.php - 입력 부분</p><p>modify.php - 수정 부분</p><p>delete.php - 삭제 부분</p><p>select.php - 검색 부분</p><p><br></p><p>먼저 common.php를 만들었다.</p><pre><code class="PHP" data-type="Entity">class Comment{
  private $idx;
  private $id;
  private $email;
  private $parent;
  private $createdate;
  private $lastupdated;
  private $comment;
  private $child;
  
  public function setIdx($idx){
    $this-&gt;idx = $idx;
  }
  public function getIdx(){
    return $this-&gt;idx;
  }
  public function setId($id){
    $this-&gt;id = $id;
  }
  public function getId(){
    return $this-&gt;id;
  }
  public function setEmail($email){
    $this-&gt;email = $email;
  }
  public function getEmail(){
    return $this-&gt;email;
  }
  public function setParent($parent){
    $this-&gt;parent = $parent;
  }
  public function getParent(){
    return $this-&gt;parent;
  }
  public function setCreatedate($createdate){
    $this-&gt;createdate = $createdate;
  }
  public function getCreatedate(){
    return $this-&gt;createdate;
  }
  public function setLastupdated($lastupdated){
    $this-&gt;lastupdated = $lastupdated;
  }
  public function getLastupdated(){
    return $this-&gt;lastupdated;
  }
  public function setComment($comment){
    $this-&gt;comment = $comment;
  }
  public function getComment(){
    return $this-&gt;comment;
  }
  public function setChild($child){
    $this-&gt;child = $child;
  }
  public function getChild(){
    return $this-&gt;child;
  }
}</code></pre>
<p>&nbsp;위 클래스는 comment 클래스이다. 이 클래스의 목적은 데이터베이스의 값을 가져와서 클래스로 담을 생각이다. 댓글 하나의 정보가 하나의 클래스가 된다. 여러 개의 데이터를 가져오면 comment 클래스를 리스트에 담아서 사용할 생각이다. 그럼 sort나 값을 다루기도 편하다. ORM 개념이라 java나 C#에서 많이 설계하는 형태이다. PHP 세계에서는 어떻게 할까? 비슷할 거 같다.</p><p><br></p><p>&nbsp;추가로 데이터베이스와 다른 변수가 child가 있다. 이건 Comment 클래스의 리스트를 넣을 생각인데 댓글의 하위 리플 댓글 리스트가 여기에 들어간다. php는 자료형을 선언하는 게 아니라서 소스만 보고는 어떤 데이터 형태가 들어가는지 확인하기가 어렵다.</p><pre><code class="javascript" data-type="common.php">error_reporting ( E_ALL ^ E_NOTICE || E_WARNING );
class DBConn {
  private $hostname = "";
  private $username = "";
  private $password = "";
  private $dbname = "";
  public function get() {
    return new mysqli ( $this-&gt;hostname, $this-&gt;username, $this-&gt;password, $this-&gt;dbname ); 
  }
}
abstract class AbstractDao {
  private $db;
  private $mysqli;

  protected function getStmt($qy) {
    $this-&gt;db = new DBConn ();
    $this-&gt;mysqli = $this-&gt;db-&gt;get ();
    $stmt = $this-&gt;mysqli-&gt;prepare ( $qy );
    return $stmt;
  }
  protected function close() {
    $this-&gt;mysqli-&gt;close ();
  }
  
  public function execute(){
    header("content-type: application/json; charset=utf-8");
    header("Access-Control-Allow-Origin:*");
    return json_encode($this-&gt;run());
  }
  protected abstract function run();
}</code></pre>
<p>&nbsp;먼저 Common 클래스에는 데이터베이스 커넥션(DBConn)과 입력, 수정, 삭제, 검색의 상위 클래스(common)을 만들었다. 네 가지 기능의 공통적인 함수를 common 클래스에 넣었다. 그리고 일단 네 가지 액션 모두 데이터베이스 접속을 하는 것 같고, 웹 해더영역도 ajax로만 사용하기 때문에 header를 공통에 선언했다. 그리고 나는 cross 플랫폼이기 때문에 해더에 모든 사이트에서 허용한다고 설정했다. 이걸 안 하면 아마 ajax로 받아오는 곳에서 security 에러 난다.&nbsp;</p><p><br></p><p>&nbsp;그리고 execute를 호출하면 하위 클래스에선 run함수가 호출하게 된다. 나는 항상 프로그램 설계를 할 때 하위 클래스(업무 영역)이 직접 호출하게 하지 않는다. 이유는 관리적인 문제 때문인데 하위 클래스를 직접 호출하는 영역이 많아질수록 에러가 발생했을 때 찾기가 어려워져서다. 이게 정답은 아니고 그냥 사람마다 설계하는 스타일인데 나는 이렇게 작성하는 것을 좋아한다. 그리고 run에서는 array값을 리턴을 받고 array로 받으면 json으로 변환하여 리턴하는 형태로 만들었다.</p><p><br></p><p>&nbsp;php가 함수 return 타입과 변수 타입을 선언하지 않기 때문에 코드만으로 무슨 값이 오는지 알 수가 없다. 그런 면은 다른 언어보다 가독성이 참 떨어진다. 주석으로 설명해야 하나? 나는 코드에 주석 다는 걸 별로 좋아하지 않는데..</p>
                                </article>
                            </div>
                            <div class="row justify-content-end mb-3 date-items">
                                <div class="col-12 font-7 text-align-right gray-font">
                                    <p class="mb-0"><span class="text-align-left" style="display:inline-block;">블로그의 글은 모두 개인 경험과 지식으로 나온 글이기에 정확하지 않을 수 있습니다. 표준 또는 사실과 다른 글이 있으면 댓글 또는 메일 보내주세요.</span></p>
                                    <p class="mb-0">Mail: <a href="mailto:nowonbun@gmail.com">nowonbun@gmail.com</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class='row mt-3 mb-3'><div class='col-12 d-flex align-items-stretch'><div class='card my-style-custom'><div class='my-pre-post-nav'><div class='row'><div class='col-12 mb-1'><p class='my-pre-list-title' style='margin-bottom:0px;'><a class='prenext-link' href='/Dialy/commentDatabase20171130.html'> <span class='my-pre-next-icon'><i class='fa fa-chevron-up'></i>이전글</span>[블로그 구축 12일 차] 블로그 댓글 기능 달기 - 3 (DB 설계)</a><span class='my-list-date float-right date-type-1 font-7'>2018년 12월 01일 13시 30분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-12-01 13:30 작성</span></p></div> <div class='col-12 my-blog-line'></div> <div class='col-12 mt-1'><p class='my-pre-list-title' style='margin-bottom:0px;'><a class='prenext-link' href='/Dialy/22c4b209f70d4f4b95b2bc822da6fc69.html'> <span class='my-pre-next-icon'><i class='fa fa-chevron-down'></i>다음글</span>[블로그 구축 14일 차] 블로그 댓글 기능 달기 -5(server 작성)</a><span class='my-list-date float-right date-type-1 font-7'>2018년 12월 02일 17시 12분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-12-02 17:12 작성</span></p></div></div></div></div></div></div>
            <fieldset class="box-shadow-0 px-3 py-3 blog-radius mb-3 my-style-custom">
                <legend class="box-shadow-0 blog-legend px-3 blog-radius mb-0">
                    <label>최신글</label>
                </legend>
                <ul class="pl-3">
                    <li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/b4dfd57f33fe41918e073afeb56b9acd.html'>[개발일기] [Centos 개발 서버 설치] 쉘 프롬프트 설정<span class='my-list-date float-right date-type-1 font-7'>2019년 01월 05일 00시 51분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2019-01-05 00:51 작성</span></a></div></li><li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/bf6f61376771417bae8d6ff4f244cef9.html'>[개발일기] [Centos 개발 서버 설치] root 계정 접속 제한 및 wheel 그룹 추가<span class='my-list-date float-right date-type-1 font-7'>2019년 01월 04일 23시 53분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2019-01-04 23:53 작성</span></a></div></li><li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Experience/4baf26e0f85448eda758c5c738380b35.html'>[개발경험] 프로그램 개발자의 외부 시선과 현업에서 보는 시선의 차이<span class='my-list-date float-right date-type-1 font-7'>2018년 12월 27일 23시 27분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-12-27 23:27 작성</span></a></div></li><li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Experience/396638c83e0b4ec3bcef890c0b9a4b48.html'>[개발경험] 프로그램 프로젝트를 성공시키는 방법<span class='my-list-date float-right date-type-1 font-7'>2018년 12월 27일 23시 21분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-12-27 23:21 작성</span></a></div></li><li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/6e7786aceb3c4029a70982b83fe9734f.html'>[개발일기] [가계부 프로젝트 11일 차] 메뉴 만들기<span class='my-list-date float-right date-type-1 font-7'>2018년 12월 24일 23시 45분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-12-24 23:45 작성</span></a></div></li><li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/af750c7dde634806afb0a834aff6afc1.html'>[개발일기] [Centos 개발 서버 설치] Maria DB 설치하기<span class='my-list-date float-right date-type-1 font-7'>2018년 12월 23일 22시 33분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-12-23 22:33 작성</span></a></div></li>
                </ul>
            </fieldset>
            <fieldset class="box-shadow-0 px-3 py-3 blog-radius mb-3 my-style-custom">
                <legend class="box-shadow-0 blog-legend px-3 blog-radius">
                    <label>댓글 달기</label>
                </legend>
                <div id="commentSystem">
					<div id="googleSigninButton"></div>
                    <div id="commentInsertForm" class="comment-form-border"  style="display:none;">
						<div style="text-align:right;">
							<button type="button" class="btn btn-sm btn-outline-success waves-effect" id="createComment">작성하기</button>
						</div>
						<div class="md-form comment-form">
						  <textarea id="commentText" class="form-control md-textarea comment-textarea" maxlength="300" length="300" rows="3"></textarea>
						  <label for="commentText" class="comment-textarea-label">댓글 작성하기</label>
						</div>
					</div>
					<div id="commentList" class="comment-list"></div>
                </div>
            </fieldset>
        </main>
        <footer class="page-footer text-center font-small mdb-color mt-4 wow fadeIn my-blog-footer">
            <div class="footer-copyright py-1">
                2018 Copyright: <a href="#" target="_blank">www.nowonbun.com </a>
            </div>
        </footer>
        <div id="ImgModal" class="modal">
            <span class="close">&times;</span>
            <img class="modal-content">
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="/js/compiled-4.5.9.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script src="/js/highlightjs-line-numbers.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>hljs.initLineNumbersOnLoad();</script>
    <script type="text/javascript" src="/js/post.js" charset="utf-8"></script>
    <script type="text/javascript" src="https://apis.google.com/js/platform.js?onload=onLoad" async defer></script>
    <script type="text/javascript" src="/js/comment.min.js"></script>
</body>
</html>