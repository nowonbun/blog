<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="naver-site-verification" content="32aa8ce7d767e05669cb5b31f2579de56cc15359" />
    <meta name="keywords" content="명월 일기, 프로그램 개발, 프로젝트 구축, 개발 노하우" />
    <meta name="description" content="기본적인 자료조사는 끝났고, 드디어 프로그래밍을 위한 첫 단계인 데이터베이스 설계이다. 데이터베이스는 처음 설계하면 나중에 운영하는 중에는 .." />
    <meta name="Author" content="nowonbun@gmail.com" />
    <meta name="distribution" content="nowonbun@gmail.com" />
    <meta name="copyright" content="nowonbun@gmail.com" />
    <meta name="title" content="명월의 개발 일기 : [개발일기] : [블로그 구축 12일 차] 블로그 댓글 기능 달기 - 3 (DB 설계)" />
    <meta name="robots" content="ALL">
    <meta property="og:title" content="명월의 개발 일기" />
    <meta property="og:description" content="기본적인 자료조사는 끝났고, 드디어 프로그래밍을 위한 첫 단계인 데이터베이스 설계이다. 데이터베이스는 처음 설계하면 나중에 운영하는 중에는 .." />
    <meta property="og:url" content="http://www.nowonbun.com/Dialy/commentDatabase20171130.html" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="명월 일기, 프로그램 개발, 프로젝트 구축, 개발 노하우" />

    <meta property="og:image" content="http://www.nowonbun.com/img/ogimage.jpg" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="200" />
    <meta property="og:image:height" content="200" />
    <meta property="og:image:alt" content="명월 일기 타이포 그래피" />
    <meta name="google-signin-client_id" content="220458850151-75q8c5ids3m5krr49qj4tif6t84liubj.apps.googleusercontent.com">

    <title>명월의 개발 일기 : [개발일기] : [블로그 구축 12일 차] 블로그 댓글 기능 달기 - 3 (DB 설계)</title>
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="/css/compiled-4.5.9.min.css" rel="stylesheet">
    <link href="/css/style.min.css" rel="stylesheet">
    <link href="/css/common.css" rel="stylesheet">
    <link href="/css/post.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/rainbow.min.css" rel="stylesheet">
    <link href="/css/highlight.init.css" rel="stylesheet">
    <link href="/css/comment.css" rel="stylesheet">

    <link rel="icon" type="favicon.ico" href="/img/favicon.ico">
    <link rel="canonical" href="http://www.nowonbun.com" />
    <link rel="alternate" type="application/rss+xml" title="명월의 개발 일기" href="http://www.nowonbun.com/rss" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-58360998-4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-58360998-4');
    </script>
    <script type="text/javascript" src="//wcs.naver.net/wcslog.js"></script>
    <script type="text/javascript">
        if (!wcs_add) var wcs_add = {};
        wcs_add["wa"] = "c2a9ed02f53908";
        wcs_do();
    </script>
</head>
<body lang="ko">
    <div id="bodyMain" class="container wow fadeIn animated" style="visibility: visible; animation-name: fadeIn;">
        <header class="mt-5">
            <section class="card my-blog-header">
                <div class="background"></div>
                <div class="card-body text-center py-3 px-3 my-3">
                    <h1 class="mb-4" style="margin:0px!important;">
                        <strong>명월의 개발 일기</strong>
                    </h1>
                </div>
                <nav class="navbar navbar-expand-lg navbar-light white menu-nav-tool-blog">
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" id="menuToggler">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mr-auto">
                            <li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/'>홈</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog  active ' href='/DialyList.html'>개발일기</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/ExperienceList.html'>개발경험</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/JapanLifeList.html'>일본생활</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/KoreanLifeList.html'>한국생활</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/CodingNoteList.html'>코딩노트</a></li>
<li class='nav-item'><a class='nav-link text-uppercase waves-effect waves-light menu-nav-blog ' href='/FavoritesList.html'>즐겨찾기</a></li>

                        </ul>
                    </div>
                </nav>
            </section>
        </header>
        <main class="mt-5">
            <div class="row mb-3">
                <div class="col-12 d-flex align-items-stretch">
                    <div class="card my-blog-post">
                        <div class="card-body">
                            <h2 class="card-title">
                                [블로그 구축 12일 차] 블로그 댓글 기능 달기 - 3 (DB 설계)
                            </h2>
                            <div class="row justify-content-end mb-3 date-items">
                                <div class="col-12" style="line-height:10px;text-align:right;">
                                    <div class="date-type-1">
                                        <span class="my-list-date font-7">작성일시 : 2018년 12월 01일 13시 30분</span><br />
                                        <span class="my-list-date font-7">최종수정일시 : 2018년 12월 15일 02시 20분</span>
                                    </div>
                                    <div class="date-type-2">
                                        <span class="my-list-date font-7">작성: 2018-12-01 13:30</span><br />
                                        <span class="my-list-date font-7">최종수정: 2018-12-15 02:20</span>
                                    </div>
                                    <div style="display:inline-block">
                                        <img src="/img/copyrightmark.png" style="height: 25px;margin-top: -13px;margin-left: 11px;">
                                    </div>
                                </div>
                            </div>
                            <div class="card-text pt-3 pb-3">
                                <!--<div class='view overlay rounded z-depth-1 post-image-area'>
                                    <img class='article-image img-fluid' src='#####IMAGE#####' />
                                    <div class='mask rgba-white-slight'></div>
                                </div>
                                <p class="image-comment">#####IMAGECOMMNET#####</p>-->
                                <article>
                                    <p>&nbsp;기본적인 자료조사는 끝났고, 드디어 프로그래밍을 위한 첫 단계인 데이터베이스 설계이다. 데이터베이스는 처음 설계하면 나중에 운영하는 중에는 바꾸기가 매우 어려운 영역이다. 그래서 나는 가장 중요하다고 생각하는 부분이 설계라고 생각한다.</p><p><br></p><p>&nbsp;설계 방식은 사람마다 방식이 다르고 구조도 많이 다르다. 구조를 설계하는 방법에는 데이터베이스 정규화라고 어느 정도 정해진 규칙이 있다. 그러나 실무에서는 요구사항과 차이가 있는 경우도 있고 로그나 성능을 위해서 반드시 정규화의 규칙을 따라서 설계할 필요는 없다. 상황에 따라 데이터 중복이나 레퍼런스를 연결 안 하는 경우도 있다. 그러나 가능하면 정규화에 맞추어서 만드는 것이 이상적이다. 그래서 설계는 딱 정해진 규칙이 없고 그냥 많이 만들어보고 많이 운영해보고 문제점을 느끼면 다음 설계부터는 고려해서 다시 설계하고... 데이터베이스 설계영역은 그래서 경험이 많이 중요하다.</p><pre><code class="SQL" data-type="데이터베이스 설계">CREATE TABLE COMMENT_T(
  IDX INT NOT NULL AUTO_INCREMENT,
  URL NVARCHAR(255) NOT NULL,
  ID NVARCHAR(255) NOT NULL,
  IP NVARCHAR(255) NOT NULL,
  EMAIL NVARCHAR(255) NOT NULL,
  COMMENT NVARCHAR(4000) NULL,
  PARENT INT NULL,
  ISDELETED BIT DEFAULT 0 NOT NULL,
  CREATEDDATE DATETIME NOT NULL,
  LASTUPDATED DATETIME NOT NULL,

  PRIMARY KEY(IDX),
  FOREIGN KEY (PARENT) REFERENCES COMMENT(IDX)
);
CREATE TABLE COMMENT_H(
  IDX INT NOT NULL AUTO_INCREMENT,
  oIDX INT NOT NULL,
  URL NVARCHAR(255) NULL,
  ID NVARCHAR(255) NULL,
  IP NVARCHAR(255) NULL,
  EMAIL NVARCHAR(255) NULL,
  COMMENT NVARCHAR(4000) NULL,
  PARENT INT NULL,
  ISDELETED BIT NULL,
  CREATEDDATE DATETIME NULL,
  LASTUPDATED DATETIME NULL,
  HISTORYDATE DATETIME NOT NULL,

  PRIMARY KEY(IDX)
);</code></pre>
<p>&nbsp;블로그 댓글 기능을 위한 데이터베이스 설계는 일단 마스터 테이블은 만들지 않았다. 트랜잭션 테이블 하나와 히스토리 테이블이다. 두 테이블은 idx에 auto_increament 제약을 주어서 테이블 키로 설정했다. 그리고 url 컬럼은 어느 댓글 페이지인지 구분할 생각이다. 그러니깐 location.origin + location.pathname 을 넣는 다는 의미다. location.href을 안 넣는 이유는 사용하는 페이지에 파라미터가 있으면 다른 페이지로 인식돼버리기 때문이다. id와 email은 oauth로부터 받은 id를 넣을 것이고 ip는 client ip주소이. 혹시나 나중에 ddos 대책을 위해 넣어 놨다. comment는 댓글 내용이 된다. 그리고 parent는 self reference를 걸었는데 여기는 댓글의 리플을 위한 항목이다. isdeleted는 삭제할 경우 물리적 삭제가 아닌 논리적 삭제를 할 예정이다.</p><p><br></p><p>&nbsp;COMMENT_H의 테이블은 댓글 수정이 있으면 로그를 남겨놓기 위한 테이블이다. triger는 작성하지 않고 소스 상에서 insert select 할 예정이다. 왜냐하면, 무료 웹 호스팅이다 보니 mysql버전이 낮다. 그러다 보니 triger로 예기치 못한 에러가 나올 수 있으니 최대한 안전하게 처리하기 위함이다.</p><p><br></p><p>&nbsp;여기까지 데이터베이스 설계가 완료되었다. 다음은 댓글 서버스크립트(PHP)를 만들 생각이다.</p>
                                </article>
                            </div>
                            <div class="row justify-content-end mb-3 date-items">
                                <div class="col-12 font-7 text-align-right gray-font">
                                    <p class="mb-0"><span class="text-align-left" style="display:inline-block;">블로그의 글은 모두 개인 경험과 지식으로 나온 글이기에 정확하지 않을 수 있습니다. 표준 또는 사실과 다른 글이 있으면 댓글 또는 메일 보내주세요.</span></p>
                                    <p class="mb-0">Mail: <a href="mailto:nowonbun@gmail.com">nowonbun@gmail.com</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class='row mt-3 mb-3'><div class='col-12 d-flex align-items-stretch'><div class='card my-style-custom'><div class='my-pre-post-nav'><div class='row'><div class='col-12 mb-1'><p class='my-pre-list-title' style='margin-bottom:0px;'><a class='prenext-link' href='/Dialy/oAuth20181130.html'> <span class='my-pre-next-icon'><i class='fa fa-chevron-up'></i>이전글</span>[블로그 구축 11일 차] 블로그 댓글 기능 달기 - 2 (구글의 oauth)</a><span class='my-list-date float-right date-type-1 font-7'>2018년 11월 30일 01시 09분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-11-30 01:09 작성</span></p></div> <div class='col-12 my-blog-line'></div> <div class='col-12 mt-1'><p class='my-pre-list-title' style='margin-bottom:0px;'><a class='prenext-link' href='/Dialy/32d7d7135654429faf3cbdfe618bae00.html'> <span class='my-pre-next-icon'><i class='fa fa-chevron-down'></i>다음글</span>[블로그 구축 13일 차] 블로그 댓글 기능 달기 -4 (server 작성)</a><span class='my-list-date float-right date-type-1 font-7'>2018년 12월 01일 23시 02분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-12-01 23:02 작성</span></p></div></div></div></div></div></div>
            <fieldset class="box-shadow-0 px-3 py-3 blog-radius mb-3 my-style-custom">
                <legend class="box-shadow-0 blog-legend px-3 blog-radius mb-0">
                    <label>최신글</label>
                </legend>
                <ul class="pl-3">
                    <li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/9b33bfad04354d189e291a00d9aada40.html'>[개발일기] [가계부 프로젝트 9일 차] Bootstrap 화면 디자인과 설정.<span class='my-list-date float-right date-type-1 font-7'>2018년 12월 20일 23시 44분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-12-20 23:44 작성</span></a></div></li><li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/29b6376cd9724bc68e601a9e705b70d4.html'>[개발일기] [가계부 프로젝트 8일 차] Startup페이지와 로그인 페이지 만들기.<span class='my-list-date float-right date-type-1 font-7'>2018년 12월 19일 23시 16분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-12-19 23:16 작성</span></a></div></li><li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/f4ded5e5104f42e58e3016b6ab455da1.html'>[개발일기] [가계부 프로젝트 7일 차] 프레임워크 설정하기 -3(ORM - DAO만들기)<span class='my-list-date float-right date-type-1 font-7'>2018년 12월 18일 23시 43분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-12-18 23:43 작성</span></a></div></li><li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/49d601fe0e4f47d4aa239d54b4fdfba3.html'>[개발일기] [가계부 프로젝트 6일차] 프레임워크 설정하기 -2(ORM - JPA설정)<span class='my-list-date float-right date-type-1 font-7'>2018년 12월 17일 23시 42분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-12-17 23:42 작성</span></a></div></li><li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/1cb972bac45f49e8ad95a702a5036541.html'>[개발일기] [가계부 프로젝트 5일 차] 프레임워크 설정하기 -1(Spring)<span class='my-list-date float-right date-type-1 font-7'>2018년 12월 17일 23시 27분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-12-17 23:27 작성</span></a></div></li><li class='row'><div class='col-12 mb-0'><i class='fa fa-caret-right mr-2'></i><a href='/Dialy/bc17c18a6f714544b1058062a255c7f8.html'>[개발일기] [Cenos 개발 서버 설치] 삼바(Samba) 설치하기<span class='my-list-date float-right date-type-1 font-7'>2018년 12월 17일 01시 50분에 작성된 글...</span><span class='my-list-date float-right date-type-2 font-7'>2018-12-17 01:50 작성</span></a></div></li>
                </ul>
            </fieldset>
            <fieldset class="box-shadow-0 px-3 py-3 blog-radius mb-3 my-style-custom">
                <legend class="box-shadow-0 blog-legend px-3 blog-radius">
                    <label>댓글 달기</label>
                </legend>
                <div id="commentSystem">
					<div id="googleSigninButton"></div>
                    <div id="commentInsertForm" class="comment-form-border"  style="display:none;">
						<div style="text-align:right;">
							<button type="button" class="btn btn-sm btn-outline-success waves-effect" id="createComment">작성하기</button>
						</div>
						<div class="md-form comment-form">
						  <textarea id="commentText" class="form-control md-textarea comment-textarea" maxlength="300" length="300" rows="3"></textarea>
						  <label for="commentText" class="comment-textarea-label">댓글 작성하기</label>
						</div>
					</div>
					<div id="commentList" class="comment-list"></div>
                </div>
            </fieldset>
        </main>
        <footer class="page-footer text-center font-small mdb-color mt-4 wow fadeIn my-blog-footer">
            <div class="footer-copyright py-1">
                2018 Copyright: <a href="#" target="_blank">www.nowonbun.com </a>
            </div>
        </footer>
        <div id="ImgModal" class="modal">
            <span class="close">&times;</span>
            <img class="modal-content">
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="/js/compiled-4.5.9.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script src="/js/highlightjs-line-numbers.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>hljs.initLineNumbersOnLoad();</script>
    <script type="text/javascript" src="/js/post.js" charset="utf-8"></script>
    <script type="text/javascript" src="https://apis.google.com/js/platform.js?onload=onLoad" async defer></script>
    <script type="text/javascript" src="/js/comment.min.js"></script>
</body>
</html>